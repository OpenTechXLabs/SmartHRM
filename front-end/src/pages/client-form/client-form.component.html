<div class="form-container mat-elevation-z8">
  <div class="mat-toolbar mat-toolbar-color-primary add-client-banner">
    <h5>{{ formHeading }}</h5>
    <button mat-icon-button class="close-button" (click)="closeDialog()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <br />

  <div class="section">
    <h6>Company Details</h6>
    <form #clientForm="ngForm">
      <div class="form-row">
        <mat-form-field appearance="fill" class="form-group">
          <mat-label>Company Name <span class="required"></span></mat-label>
          <input
            matInput
            placeholder="Enter company name"
            [(ngModel)]="clients.cl_name"
            name="cl_name"
            required
          />
          <mat-error *ngIf="clientForm.submitted && !clients.cl_name">Company name is required.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-group">
          <mat-label>Company Type <span class="required"></span></mat-label>
          <mat-select [(ngModel)]="clients.cl_type" name="cl_type">
            <mat-option value="">Select company type</mat-option>
            <mat-option value="service">Service Based</mat-option>
            <mat-option value="product">Product Based</mat-option>
            <mat-option value="both">Both</mat-option>
          </mat-select>
          <mat-error *ngIf="clientForm.submitted && !clients.cl_type">Company type is required.</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-group">
          <mat-label>Company Email <span class="required"></span></mat-label>
          <input
            matInput
            type="email"
            placeholder="Enter company email"
            [(ngModel)]="clients.cl_email"
            name="cl_email"
            required
            #emailInput="ngModel"
            email
          />
          <!-- Error message for required email field -->
          <mat-error *ngIf="emailInput.invalid && (emailInput.dirty || clientForm.submitted)">
            Please enter a valid email address.
          </mat-error>
        </mat-form-field>
        

        <mat-form-field appearance="fill" class="form-group">
          <mat-label>Contact Person Name <span class="required"></span></mat-label>
          <input
            matInput
            type="text"
            placeholder="Enter contact person name"
            [(ngModel)]="clients.cl_co_per_name"
            name="cl_co_per_name"
            required
          />
          <mat-error *ngIf="clientForm.submitted && !clients.cl_co_per_name">Contact person name is required.</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-group">
          <mat-label>Address</mat-label>
          <input
            matInput
            placeholder="Enter company address"
            [(ngModel)]="clients.cl_addr"
            name="cl_addr"
          />
          <mat-error *ngIf="clientForm.submitted && !clients.cl_addr">Address is required.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-group">
          <mat-label>Map Link</mat-label>
          <input
            matInput
            placeholder="Enter map link"
            [(ngModel)]="clients.cl_map_url"
            name="cl_map_url"
          />
          <mat-error *ngIf="clientForm.submitted && !clients.cl_map_url">Map link is required.</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-group">
          <mat-label>Contact Number <span class="required"></span></mat-label>
          <input
            matInput
            type="tel"
            placeholder="Enter contact number"
            [(ngModel)]="clients.cl_phno"
            name="cl_phno"
            required
            pattern="^\+?\d{10,12}$"
            #phone="ngModel"
          />
          <mat-error *ngIf="phone.invalid && phone.touched">Contact number is required.</mat-error>
          <mat-error *ngIf="phone.errors?.['pattern']">Phone number must be numeric and may include a leading '+' (e.g. +1234567890).</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-group">
          <mat-label>Client Notes</mat-label>
          <textarea
            matInput
            rows="3"
            [(ngModel)]="clients.cl_notes"
            name="cl_notes"
            (input)="checkWordCount()"
            [attr.maxlength]="maxLength"
          ></textarea>
          <mat-error *ngIf="wordCountExceeded">
            You have exceeded the word limit of 1000 words.
          </mat-error>
          <div *ngIf="clients.cl_notes" class="word-count">
            Word count: {{ currentWordCount }} / 1000
          </div>
        </mat-form-field>
      </div>
      
      <mat-checkbox [(ngModel)]="clients.cl_si_ag" name="cl_si_ag" [disabled]="isSubmitDisabled">
          Agreement signed
        </mat-checkbox>
    
    </form>
  </div>

  <div class="section">
    <div class="contacts-section">
      <div *ngFor="let contact of clients.contacts; let i = index" class="contact-person" style="border: 1px solid #ccc; padding: 16px; margin-bottom: 16px; border-radius: 4px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h6>Other Contact Person {{ i + 1 }}</h6> 
          <button mat-icon-button color="warn" (click)="removeContactPerson(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <div class="form-row">
          <mat-form-field appearance="fill" class="form-group">
            <mat-label>Name <span class="required"></span></mat-label>
            <input
              matInput
              [value]="contact.co_name" 
              placeholder="Enter name"
              [(ngModel)]="contact.co_name"
              name="co_name_{{ i }}"
              
            />
            <mat-error *ngIf="clientForm.submitted && !contact.co_name">Name is required.</mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill" class="form-group">
            <mat-label>Hiring Position</mat-label>
            <input
              matInput
              placeholder="Enter hiring position"
              [(ngModel)]="contact.co_position_hr"
              name="co_position_hr_{{ i }}"
            />
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="fill" class="form-group">
            <mat-label>Phone Number <span class="required"></span></mat-label>
            <input
              matInput
              type="tel"
              placeholder="Enter phone number"
              [(ngModel)]="contact.co_phno"
              name="co_phno_{{ i }}"
              maxlength="12"
              #phoneInput="ngModel"
         
              pattern="^\+?\d{1,4}[\s\-]?\(?\d{1,3}\)?[\s\-]?\d{1,4}[\s\-]?\d{1,4}[\s\-]?\d{1,4}$"
            />
            <mat-error *ngIf="phoneInput.errors?.['pattern']">
              Invalid phone number format. Please enter a valid phone number (e.g., +123-456-7890).
            </mat-error>
            <mat-error *ngIf="phoneInput.errors?.['required']">
              Phone number is required.
            </mat-error>
          </mat-form-field>
          
          
          
          <mat-form-field appearance="fill" class="form-group">
            <mat-label>Email <span class="required"></span></mat-label>
            <input
              matInput
              type="email"
              placeholder="Enter email"
              [(ngModel)]="contact.co_email"
              name="co_email_{{ i }}"
            
              pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
              #emailInput="ngModel"
            />
            <mat-error *ngIf="emailInput.errors?.['required']">
              Email is required.
            </mat-error>
            <mat-error *ngIf="emailInput.errors?.['pattern']">
              Please enter a valid email address.
            </mat-error>
          </mat-form-field>
          
        </div>
      </div>
    </div>

    <div *ngIf="formInvalidMessage" class="error-message">
      <span style="color: red;">{{ formInvalidMessage }}</span>
    </div>
    <br>

    <button mat-raised-button color="primary" (click)="addContactPerson()" style="display: flex; justify-content: flex-start;">Add Contact Person</button>

    <div class="button-container">
      <button mat-raised-button color="accent" [disabled]="isSubmitDisabled" (click)="onSubmit()">Submit</button>
    </div>
  </div>
</div>
